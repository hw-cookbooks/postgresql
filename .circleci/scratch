kitchen: &kitchen
  machine: true
  environment:
    KITCHEN_LOCAL_YAML: .kitchen.dokken.yml
  steps:
    - checkout
    - run:
        name: Install Chef
        <<: *install_chef
    - run:
        name: amazonlinux
        command: kitchen test $CIRCLE_JOB-amazonlinux
    Network failure to be fixed
    - run:
        name: centos-6
        command: kitchen test $CIRCLE_JOB-centos-6
    - run:
        name: centos-7
        command: kitchen test $CIRCLE_JOB-centos-7
    - run:
        name: debian-8
        command: kitchen test $CIRCLE_JOB-debian-8
    - run:
        name: debian-9
        command: kitchen test $CIRCLE_JOB-debian-9
    - run:
        name: fedora-28
        command: kitchen test $CIRCLE_JOB-fedora-28
    - run:
        name: ubuntu-16.04
        command: kitchen test $CIRCLE_JOB-ubuntu-1604
    - run:
       name: ubuntu-18.04
       command: kitchen test $CIRCLE_JOB-ubuntu-1804
     service[postgresql] action startToo long with no output (exceeded 10m0s)

      - repo:
          requires:
            - lint
            - danger
      - server-install:
          requires:
            - lint
            - danger
      - client-install:
          requires:
            - lint
            - danger
      - access:
          requires:
            - lint
            - danger
      - ident:
          requires:
            - lint
            - danger
      # - extension:
      #     requires:
      #       - lint
      #       - danger
      # Failure /usr/share/pgsql/extension/adminpack--1.0.sql: No such file or directory
      - initdb:
          requires:
            - lint
            - danger


  repo:
    <<: *kitchen
  server-install:
    <<: *kitchen
  client-install:
    <<: *kitchen
  access:
    <<: *kitchen
  ident:
    <<: *kitchen
  extension:
    <<: *kitchen
  initdb:
    machine: true
    environment:
      KITCHEN_LOCAL_YAML: .kitchen.dokken.yml
    steps:
      - checkout
      - run:
          name: Install Chef
          <<: *install_chef
      - run:
          command: kitchen test initdb-locale-centos-7
